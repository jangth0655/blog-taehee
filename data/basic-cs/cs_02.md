---
title: TCP·IP 4계층 모델 및 데이터 송수신 과정
category: test
createdAt: 2023/01/28
updatedAt: 2023/01/29
---

https://blog.kakaocdn.net/dn/uSn7R/btq9ml8Irna/cFTH47v7ynIR2UO9q9Tw70/img.png

- 계층들은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계되었다.  
  (TCP → UDP로 변경한다고 해서 웹브라우저를 다시 설치하지 않는다.)

#

- 캡슐화 과정
  애플리케이션 계층에서 데이트 링크 계층으로 가면서 헤더를 포함시키는 과정

- 비캡슐화 과정
  데이터링크 계층에서 상위 계층으로 각 헤더부분을 제거하는 과정

- **PDU**

> 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위로 **각 계층에 해더가 추가**될 수록 데이터 전송단위가 달라진다.  
> 관련 정보들이 담겨있는 헤더와 데이터를 담고 있는 페이로드 (**헤더 + 페이로드**)로 구성되어 있다.

1️⃣ 애플리케이션 계층 (메시지, 문자열)

2️⃣ 애플리케이션 계층 → 전송계층 (TCP - 세그먼트, UDP - 데이터그램)

3️⃣ 전송계층 → 인터넷 계층 (패킷)

4️⃣ 인터넷 계층 → 링크 계층(프레임)

#

---

## · 애플리케이션 계층

FTP,HTTP, SSH, SMTP, DNS 등 응용프로그램이 사용되는 계층으로 **실질적으로 사용자에게 제공하는 층**

#

## · 전송계층

**애플리케이션 계층과 인터넷 계층 사이의 데이터가 전달될 떄 중계역할**을 한다.

- **TCP** : 패킷 사이의 순서를 보장하고 **연결지향 프로토콜**을 사용해 **신뢰성 보장**과 수신여부 확인
- UDP : 순서 보장 ❌, 수신 여부 확인 ❌

#

### ✔️ TCP

https://afteracademy.com/images/what-is-a-tcp-3-way-handshake-process-three-way-handshaking-establishing-connection-6a724e77ba96e241.jpg

**TCP는 Port를 이용하여 연결을 시도**한다. 즉 한쪽 단말(Endpoint)에 도착한 데이터가 어느 입구(port)로 들어가야 할지 알아야 연결을 시도할 수 있기 때문이다.

> _✔️ 예를들어 http 문서를 주고 받을 때 데이터 통신을 하려면 80port로 연결해야한다_.

#

- 송신자와 수신자의 논리적 연결을 생성하고 **신뢰성 있는 데이터를 주고 받을 수 있도록** 해준다.

#

✅ 연결 성립과정 (**3-way-handshake**)

- SYN(연결 요청 플래그): 서버에 클라이언트 ISN을 담아 SYN를 보낸다.
  > ✔️ ISN : 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의 시퀀스 번호
- SYN+ACK : 클라이언트의 SYN를 수신하고 서버의 ISN을 전송 (클라이언트의 ISN+1 전송)
- ACK(응답 플래그) : ISN+1한 값인 승인번호를 담아 다시 ACK를 서버로 보낸다.

#

✅ TCP 연결 해제과정 (4-way-handshake)

1️⃣ Step

클라이언트는 연결을 종료하고자 서버에 FIN플래그를 보내고 FIN_WAIT 상태에 들어간다.

2️⃣ Step

서버는 클라이언트에게 FIN 플래그를 받은 뒤  ACK을 보낸 후 데이터를 모두 보낼 때 까지 TIME_OUT이 된다. 이 때 서버는 CLOSE_WAIT 상태이다.

3️⃣ Step

서버가 연결을 종료할 준비가 되면, 연결 해제할 준비가 되었다는 FIN플래그를 클라이언트에게 전송하고,
서버는 LAST_ACK 상태가 된다.

4️⃣ Step

클라이언트는 서버로 ACK를 보내고 클라이언트는 TIME_WAIT 상태가 된다. 클라이언트의 ACK 응답을 받은 서버는 연결을 해제한다.

- 클라이언트는 ACK를 보낸 후 일정 시간동안 기다리는데 그 이유는?
  > → 지연 패킷이 발생할 경우를 대비하기 위해 (패키싱 뒤늦게 도달했을 때 데이터의 무결성을 보장하기 위해)  
  > → 두 장치가 연결이 닫혔는지 확인하기 위해서이다.

#

## 인터넷 계층

장치로부터 받은 네트워크 패킷을 IP주소로 지정된 목적지까지 라우팅하는 계층이다.  
(프로토콜로는 IP, ARP, ICMP, RARP, OSPF 가 사용됩니다.)

#

## 링크 계층(네트워크 엑세스 계층)

데이터를 전기신호로 변환하고 물리적주소, MAC 주소를 사용해 알맞은 기기로 데이터를 전달하는 계층  
이 때 프레임을 통해 에러 확인, 흐름 제어, 접근 제어를 한다.

#

https://blog.kakaocdn.net/dn/b2IZ2f/btqMNwL96LX/CwHP2NuLE8TWBrELIoDzNk/img.png
